{
    "contents" : "---\ntitle: \"figure_10\"\nauthor: \"Rubén Rellán-Ávarez & Guillaume Lobet\"\noutput: html_document\n---\n\n```{r}\n\nlibrary(tidyr)\nlibrary(plyr)\nlibrary(dplyr)\nlibrary(RColorBrewer)\nlibrary(ggplot2)\nlibrary(magrittr)\nlibrary(gridExtra)\nlibrary(rmarkdown)\nlibrary(hexbin)\nlibrary(ggsubplot)\nlibrary(cowplot)\n\n\n```\n\ndirectionality \n\n\n```{r}\ndir <- read.csv(\"data/root-data-dir.csv\")\ndir$angle <- abs(dir$angle)\n\ndir_tidy <- dir %>%\n        separate(image, into = c(\"experiment\", \"das\", \"accession\", \"water\", \n                                 \"temp\", \"transfer\", \"plant\"), sep = \"-\")\n\n\nggplot(dir_tidy, aes(x = angle, y = count, colour = water)) +\n       facet_grid(temp ~ accession) +\n        geom_point(size = 3, alpha = 0.4) +\n        geom_smooth()+\n        labs(x = \"Angle\", y = \"count\") +\n              theme(panel.grid.major = element_blank(), \n              panel.grid.minor = element_blank()) +\n        ggsave(\"directionality.pdf\", height = 12, width = 16, units = \n                       \"cm\",useDingbats = FALSE) \n\ndir_tidy %>%\n        filter(accession == \"miz1\") %>%\n  ggplot(aes(x = angle, y = count, colour = water )) +\n        geom_point(size = 3, alpha = 0.4) +\n        labs(x = \"Angle\", y = \"count\") +\n              theme(panel.grid.major = element_blank(), \n              panel.grid.minor = element_blank()) +\n        ggsave(\"directionality.pdf\", height = 12, width = 16, units = \n                       \"cm\",useDingbats = FALSE) \n\n# without the ww high temperature\n\ndir_s <- read.csv(\"data/root-data-dir-simple.csv\")\ndir_s$angle <- abs(dir_s$angle)\n\ndir_s_tidy <- dir_s %>%\n        separate(image, into = c(\"experiment\", \"accession\", \"water\", \"temp\", \"das\", \"plant\"), sep = \"-\")\n\n\nggplot(dir_s_tidy, aes(x = angle, y = count, colour = water)) +\n       facet_grid(~ accession) +\n        geom_point(size = 3, alpha = 0.4) +\n        labs(x = \"Angle\", y = \"count\") +\n              theme(panel.grid.major = element_blank(), \n              panel.grid.minor = element_blank()) +\n        ggsave(\"directionality.pdf\", height = 12, width = 16, units = \n                       \"cm\",useDingbats = FALSE) \n\ndir_hormone <- read.csv(\"data/root-data-sobel-dir.csv\")\ndir_hormone$angle <- abs(dir_hormone$angle)\n\ndir_hormone_tidy <- dir_hormone %>%\n        separate(image, into = c(\"experiment\", \"das\", \"accession\", \"water\",\n                                \"plant\", \"aq\"), sep = \"-\")\n\nggplot(dir_hormone_tidy, aes(x = angle, y = count, colour = water)) +\n       facet_grid(~ accession) +\n        geom_point(size = 3, alpha = 0.5) +\n        labs(x = \"Angle\", y = \"count\") +\n              theme(panel.grid.major = element_blank(), \n              panel.grid.minor = element_blank()) +\n        ggsave(\"directionality.pdf\", height = 12, width = 16, units = \n                       \"cm\",useDingbats = FALSE) \n\n\ndir_half <- read.csv(\"data/root-data-half-dir.csv\")\ndir_half$angle <- abs(dir_half$angle)\n\ndir_half_tidy <- dir_half %>%\n        separate(image, into = c(\"experiment\", \"das\", \"accession\", \"water\",\n                                \"plant\", \"aq\"), sep = \"-\")\n\nggplot(dir_half_tidy, aes(x = angle, y = count, colour = water)) +\n       facet_grid(~ accession) +\n        geom_point(size = 3, alpha = 0.5) +\n        geom_smooth() +\n        labs(x = \"Angle\", y = \"count\") +\n              theme(panel.grid.major = element_blank(), \n              panel.grid.minor = element_blank()) +\n        ggsave(\"directionality.pdf\", height = 12, width = 16, units = \n                       \"cm\",useDingbats = FALSE) \n\n\ndir_hormone_ks <- read.csv(\"data/root-data-half-dir-ks.csv\")\ndir_hormone_ks$angle <- abs(dir_hormone_ks$angle)\n\n              \nks.test(dir_hormone_ks$miz_ww, dir_hormone_ks$miz_wd)\n\n\n# experiment 64\n\ndir64 <- read.csv(\"data/64-root-data-dir.csv\")\ndir64$angle <- abs(dir64$angle)\n\ndir_tidy64 <- dir64 %>%\n        separate(image, into = c(\"experiment\", \"temp\", \"water\", \"transfer\", \n                                 \"das\", \"plant\", \"extra\"), sep = \"-\")\ndir_tidy64 <- tbl_df(dir_tidy64)\n\ndir_tidy64 %>%\n  filter(transfer == \"d9\") %>%\n  ggplot(aes(x = angle, y = count, colour = water)) +\n       facet_grid(temp ~ transfer) +\n        geom_smooth()+\n        labs(x = \"Angle\", y = \"count\") +\n              theme(panel.grid.major = element_blank(), \n              panel.grid.minor = element_blank()) +\n        theme_bw()\n        ggsave(\"directionality64.pdf\", height = 12, width = 12, units = \n                       \"cm\",useDingbats = FALSE) \n\n\n\n\n# time course experiment\n\n\ndir_tc <- read.csv(\"data/time-course-root-data-dir.csv\")\ndir_tc$angle <- abs(dir_tc$angle)\n\ndir_tc_tidy <- dir_tc %>%\n        separate(image, into = c(\"experiment\", \"das\", \"accesion\", \"water\", \n                                 \"plant\", \"extra\"), sep = \"-\")\ndir_tc_tidy <- tbl_df(dir_tc_tidy)\n\nggplot(dir_tc_tidy, aes(x = angle, y = count, colour = water)) +\n       facet_grid(~ das ) +\n        geom_smooth()+\n        labs(x = \"Angle\", y = \"count\") +\n              theme(panel.grid.major = element_blank(), \n              panel.grid.minor = element_blank()) +\n        theme_bw()\n\n\n\n# time course experiment with depth data\n\ndir_tc_depth <- read.csv(\"data/time-course-depth-root-data-dir.csv\")\ndir_tc_depth$angle <- abs(dir_tc_depth$angle)\n\ndir_tc_depth_tidy <- dir_tc_depth %>%\n        separate(image, into = c(\"experiment\", \"das\", \"accesion\", \"water\", \n                                 \"plant\", \"extra\"), sep = \"-\")\ndir_tc_depth_tidy <- tbl_df(dir_tc_depth_tidy)\n\ndir_tc_depth_tidy %>%\n  filter(depth < 10) %>%\n  ggplot(aes(x = angle, y = count, colour = water)) +\n      geom_point(size = 2, alpha = 0.2) +\n      ylim(0, 4) +\n      facet_grid(depth ~ das) +\n      geom_smooth()+\n      labs(x = \"Angle\", y = \"count\") +\n      theme(panel.grid.major = element_blank(), \n      panel.grid.minor = element_blank())\n\n````\n\nScript for the plot of the relationship between the soil water content and the root angle\n\n\n\n## Complete images\n\nFirst we try to plot the relation between the soil water content using **complete images** of the root segment. transformation between pixel values and humidity is based on the regression plot found the figure 5 repo.\n\n```{r}\nseg <- read.csv(\"data/2015-02-23-soil-data-all.csv\")\nseg$humidity <- 221.0 - (3.96 * seg$environment)\nseg$das <- substr(seg$image, start = 4, stop = 5)\nseg$treatment <- substr(seg$image, start = 11, stop = 12)\n\n# Create a depth factor\nmax <- max(seg$start_y)\nseg$depth[seg$start_y < (max/3)] <- 1\nseg$depth[seg$start_y > (max/3) & seg$start_y < (2*(max/3))] <- 2\nseg$depth[seg$start_y > (2*(max/3))] <- 3\n\n```\n\n\nFirst we create a faceted plot, byt das and depth\n\n```{r}\n\n# Create a faceted plot by time and depth\nggplot(data = seg, aes(x = humidity, y = direction)) + \n  facet_grid(depth~das) +\n  geom_point(aes(colour=treatment), size=1, alpha=0.7) + \n  theme_bw()+\n  ylab(\"Root direction [°]\") +\n  xlab(\"Moisture content [%]\") \n\n```\n\nthen we look at the regression on the whole dataset. It does not look that good for me....\n\n```{r}\n\n# Plot the regression for the whole dataset\nfit <- lm(seg$direction ~ seg$humidity)\nsummary(fit)\n\nggplot(data = seg, aes(x = humidity, y = direction)) + \n  geom_abline(intercept = fit$coefficients[[1]], slope = fit$coefficients[[2]], colour=\"grey\")+\n  geom_point(aes(colour=treatment), size=1, alpha=0.7) + \n  theme_bw()+\n  ylab(\"Root direction [°]\") +\n  xlab(\"Moisture content [%]\") \n\n```\n\nThen we try a regression on mean values (by das). It look a bit better.\n\n```{r}\n# Plot the regression for the mean values\nrs <- ddply(seg, .( treatment, das), summarise, \n            dir = mean(direction), \n            dir.sd = sd(direction), \n            envi=mean(humidity, na.rm = T),\n            envi.sd=sd(humidity, na.rm = T))\n\nfit <- lm(rs$dir ~ rs$envi)\nprint(summary(fit))\n\nggplot(data = rs,aes(x = envi, y = dir)) + \n  geom_abline(intercept = fit$coefficients[[1]], slope = fit$coefficients[[2]], colour=\"grey\")+\n  geom_point(aes(colour=treatment), size=2, alpha=0.7) + \n  geom_errorbar(aes(ymin = dir-dir.sd, ymax = dir+dir.sd, height=0, colour=treatment), alpha=0.7) + \n  geom_errorbarh(aes(xmin = envi-envi.sd, xmax = envi+envi.sd, height=0, colour=treatment), alpha=0.7) +\n  theme_bw()+\n  ylab(\"Root direction [°]\") +\n  xlab(\"Moisture content [%]\") \n\n\n````\n\n## Differential images\n\nNext we try to plot the relation between the soil water content but using **differential images** images of the root segment\n\n```{r}\n\nseg <- read.csv(\"data/2015-02-23-soil-data-diff.csv\")\nseg$humidity <- 221.0 - (3.96 * seg$environment)\nseg$das <- substr(seg$image, start = 4, stop = 5)\nseg$treatment <- substr(seg$image, start = 11, stop = 12)\n\n# Create a depth factor\nmax <- max(seg$start_y)\nseg$depth[seg$start_y < (max/3)] <- 1\nseg$depth[seg$start_y > (max/3) & seg$start_y < (2*(max/3))] <- 2\nseg$depth[seg$start_y > (2*(max/3))] <- 3\n\n```\n\n\nFirst we create a faceted plot, by das and depth\n\n```{r}\n# Create a faceted plot by time and depth\n\nseg %>%\n  filter(das >15) %>%\n  ggplot(aes(x = humidity, y = direction)) + \n  facet_grid(~das) +\n  geom_point(aes(colour=treatment), size=3, alpha=0.7) + \n  theme_bw()+\n  ylab(\"Root direction [°]\") +\n  xlab(\"Moisture content [%]\") \n\n\n```\n\n\nNext, we make a regression on the whole dataset. Still does not look good\n\n```{r}\n# Plot the regression for the whole dataset\nfit <- lm(seg$direction ~ seg$humidity)\nprint(summary(fit))\n\nggplot(data = seg, aes(x = humidity, y = direction)) + \n  geom_abline(intercept = fit$coefficients[[1]], slope = fit$coefficients[[2]], colour=\"grey\")+\n  geom_point(aes(colour=treatment), size=1, alpha=0.7) +\n  theme_bw()+\n  ylab(\"Root direction [°]\") +\n  xlab(\"Moisture content [%]\") \n\n# Plot the regression by day\nfit <- lm(seg$direction ~ seg$humidity)\nprint(summary(fit))\n\nggplot(data = seg, aes(x = humidity, y = direction)) +\n  geom_point(aes(colour=treatment), size=1, alpha=0.7) +\n  facet_grid(depth~das) +\n  theme_bw()+\n  ylab(\"Root direction [°]\") +\n  xlab(\"Moisture content [%]\") \n\n\n```\n\n\nThen we try a regression in the mean data (by das). This is the best one for me...\n\n```{r}\n# Plot the regression for the mean values\nrs <- ddply(seg, .( treatment, das), summarise, \n            dir = mean(direction), \n            dir.sd = sd(direction), \n            envi=mean(humidity, na.rm = T),\n            envi.sd=sd(humidity, na.rm = T)),\n            dir.se = se(direction), \n            envi.se=se(humidity, na.rm = T))\n\nfit <- lm(rs$dir ~ rs$envi)\nprint(summary(fit))\n\nggplot(data = rs,aes(x = envi, y = dir)) + \n  geom_point(aes(colour=treatment), size=2, alpha=0.7) + \n  geom_errorbar(aes(ymin = dir-dir.sd, ymax = dir+dir.sd, height=0, colour=treatment), size=0.5, alpha=0.7) + \n  geom_errorbarh(aes(xmin = envi-envi.sd, xmax = envi+envi.sd, height=0, colour=treatment), size=0.5, alpha=0.7) +\n  theme_bw()+\n  ylab(\"Root direction [°]\") +\n  xlab(\"Moisture content [%]\") +\n    ggsave(\"angle_moisture.pdf\", height = 8, width = 10, units = \n                       \"cm\",useDingbats = FALSE) \n```\n# Alternative graphs \n\n```{r}\n# simple graph\nggplot(data = seg, aes(x = humidity, y = direction)) +\n  geom_point(aes(colour=treatment), size=3, alpha=0.7) +\n  xlim(30, 80)+\n  theme_bw()+\n  ylab(\"Root direction [°]\") +\n  xlab(\"Moisture content [%]\") +\n  ggsave(\"angle_moisture_no_average.pdf\", height = 8, width = 10, units = \n                       \"cm\",useDingbats = FALSE)\n\n# rug graph\n\nggplot(data = seg, aes(x = humidity, y = direction)) +\n  geom_point(aes(colour=treatment), size=3, alpha=0.7) +\n  xlim(30, 80)+\n  theme_bw()+\n  geom_rug(col=rgb(.5,0,0,alpha=.2))+\n  ylab(\"Root direction [°]\") +\n  xlab(\"Moisture content [%]\") +\n  ggsave(\"angle_moisture_rug.pdf\", height = 8, width = 10, units = \n                       \"cm\",useDingbats = FALSE)\n\n# rug graph with facets\nggplot(data = seg, aes(x = humidity, y = direction)) +\n  geom_point(aes(colour=treatment), size=3, alpha=0.7) +\n  xlim(30, 80)+\n  theme_bw()+\n  geom_rug(col=rgb(.5,0,0,alpha=.2))+\n  facet_grid(~treatment)+hi\n  ylab(\"Root direction [°]\") +\n  xlab(\"Moisture content [%]\") +\n  ggsave(\"angle_moisture_rug_facet.pdf\", height = 8, width = 10, units = \n                       \"cm\",useDingbats = FALSE)\n\n# with geom density\n\nggplot(data = seg, aes(x = humidity, y = direction)) +\n  geom_point(aes(colour=treatment), size=3, alpha=0.7) +\n  xlim(30, 80)+\n  theme_bw()+\n  geom_density2d(aes(color=treatment))+\n  ylab(\"Root direction [°]\") +\n  xlab(\"Moisture content [%]\") +\n  ggsave(\"angle_moisture_density2d.pdf\", height = 8, width = 10, units = \n                       \"cm\",useDingbats = FALSE)\n\n# with histograms on top and sides\n\nscatter <- ggplot(data = seg, aes(x = humidity, y = direction)) +\n  geom_point(aes(colour=treatment), size=3, alpha=0.7) +\n  xlim(30, 85)+\n  theme(legend.position=c(1,1),legend.justification=c(1,1)) +\n  ylab(\"Root direction [°]\") +\n  xlab(\"Moisture content [%]\") \n\nhistogram_x <- ggplot(data = seg, aes(humidity)) +\n  geom_density(aes(colour = treatment, fill = treatment, alpha = 0.7)) +\n  xlim(30, 80) +\n  theme(legend.position = \"none\") \n\nhistogram_y <- ggplot(data = seg, aes(direction)) +\n  geom_density(aes(colour = treatment, fill = treatment, alpha = 0.7)) +\n  coord_flip() +\n  theme(legend.position = \"none\") \n\nempty <- ggplot()+geom_point(aes(1,1), colour=\"white\") +\n     theme(                              \n       plot.background = element_blank(), \n       panel.grid.major = element_blank(), \n       panel.grid.minor = element_blank(), \n       panel.border = element_blank(), \n       panel.background = element_blank(),\n       axis.title.x = element_blank(),\n       axis.title.y = element_blank(),\n       axis.text.x = element_blank(),\n       axis.text.y = element_blank(),\n       axis.ticks = element_blank()\n     ) +\n\ngrid.arrange(histogram_x, empty, scatter, histogram_y, ncol=2, nrow=2, widths=c(4, 1), heights=c(1, 4)) +\n  ggsave(\"angle_moisture_histogram_scatter.pdf\", height = 10, width = 10, units = \n                       \"cm\",useDingbats = FALSE)\n  \n\n# with histograms on top and sides and geom_density\n\nscatter <- ggplot(data = seg, aes(x = direction, y = humidity)) +\n  geom_point(aes(colour=treatment), size=2, alpha=0.7) +\n  ylim(35, 80)+\n  geom_density2d(aes(color=treatment))+\n  ylab(\"Moisture content [%]\") + \n  xlab(\"Root direction [°]\") +\n  theme_bw() +\n  theme(legend.position=c(1,1),legend.justification=c(1,1))\n\nhistogram_x <- ggplot(data = seg, aes(direction)) +\n  geom_density(aes(colour = treatment, fill = treatment, alpha = 0.7)) +\n  xlab(\"Root Direction [º]\") +\n  theme_bw() +\n  theme(legend.position = \"none\") \n\nhistogram_y <- ggplot(data = seg, aes(humidity)) +\n  geom_density(aes(colour = treatment, fill = treatment, alpha = 0.7)) +\n  xlab(\"Moisture content [%]\") +\n  xlim(35, 80) +\n  coord_flip() +\n  theme_bw() +\n  theme(legend.position = \"none\") \n\nempty <- ggplot()+geom_point(aes(1,1), colour=\"white\") +\n     theme(                              \n       plot.background = element_blank(), \n       panel.grid.major = element_blank(), \n       panel.grid.minor = element_blank(), \n       panel.border = element_blank(), \n       panel.background = element_blank(),\n       axis.title.x = element_blank(),\n       axis.title.y = element_blank(),\n       axis.text.x = element_blank(),\n       axis.text.y = element_blank(),\n       axis.ticks = element_blank()\n     )\n\ngrid.arrange(histogram_x, empty, scatter, histogram_y, ncol=2, nrow=2, widths=c(3.5, 1), heights=c(1, 3.5)) +\n  ggsave(\"angle_moisture_histogram_scatter_density.pdf\", height = 10, width = 10, units = \n                       \"cm\",useDingbats = FALSE)\n\n```\n\n# relative water content\n\n```{r}\n\nrwc <- read.csv(\"data/rwc.csv\")\nrwc %>%\n  ggplot(aes(x = transfer, y = RWC, color = water)) +\n  geom_boxplot() +\n  xlab(\"Transfer Day\") +\n  ylab(\"Relative water content (%)\") +\n  facet_grid(~temp) +\n  theme_bw()\n  ggsave(\"rwc.pdf\", height = 10, width = 10, units = \"cm\", useDingbats = FALSE)\n\n```\n\n# moisture calibration\n\n```{r}\n\nmoist_cal <- read.csv(\"data/moisture_calib.csv\")\nmoist_cal %>%\n  ggplot(aes(x = pixel_int, y = moisture)) +\n  geom_point(size = 3) +\n  stat_smooth(method=lm) +\n  xlab(\"Pixel intensity\") +\n  ylab(\"Water content (%)\") +\n  theme_bw() +\n  ggsave(\"moisture_calibration.pdf\", height = 8, width = 8, units = \"cm\", useDingbats = FALSE)\n\n```\n",
    "created" : 1433516698696.000,
    "dirty" : true,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1114611182",
    "id" : "7649892E",
    "lastKnownWriteTime" : 1433516679,
    "path" : "~/Dropbox/repos/glo_roots/figures/figure_6_7_8/figure_6.Rmd",
    "project_path" : "figure_6.Rmd",
    "properties" : {
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "type" : "r_markdown"
}