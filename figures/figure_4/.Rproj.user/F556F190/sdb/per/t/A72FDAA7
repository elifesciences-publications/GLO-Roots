{
    "contents" : "---\ntitle: \"figure_10\"\nauthor: \"Rubén Rellán-Ávarez & Guillaume Lobet\"\noutput: html_document\n---\n\n```{r}\n\nlibrary(tidyr)\nlibrary(plyr)\nlibrary(dplyr)\nlibrary(RColorBrewer)\nlibrary(ggplot2)\nlibrary(magrittr)\nlibrary(gridExtra)\nlibrary(rmarkdown)\nlibrary(hexbin)\n\n\n```\n\ndirectionality \n\n\n```{r}\ndir <- read.csv(\"data/root-data-dir.csv\")\ndir$angle <- abs(dir$angle)\n\ndir_tidy <- dir %>%\n        separate(image, into = c(\"experiment\", \"das\", \"accession\", \"water\", \n                                 \"temp\", \"transfer\", \"plant\"), sep = \"-\")\n\n\nggplot(dir_tidy, aes(x = angle, y = count, colour = water)) +\n       facet_grid(temp ~ accession) +\n        geom_point(size = 3, alpha = 0.4) +\n        geom_smooth()+\n        labs(x = \"Angle\", y = \"count\") +\n              theme(panel.grid.major = element_blank(), \n              panel.grid.minor = element_blank()) +\n        ggsave(\"directionality.pdf\", height = 12, width = 16, units = \n                       \"cm\",useDingbats = FALSE) \n\ndir_tidy %>%\n        filter(accession == \"miz1\") %>%\n  ggplot(aes(x = angle, y = count, colour = water )) +\n        geom_point(size = 3, alpha = 0.4) +\n        labs(x = \"Angle\", y = \"count\") +\n              theme(panel.grid.major = element_blank(), \n              panel.grid.minor = element_blank()) +\n        ggsave(\"directionality.pdf\", height = 12, width = 16, units = \n                       \"cm\",useDingbats = FALSE) \n\n# without the ww high temperature\n\ndir_s <- read.csv(\"data/root-data-dir-simple.csv\")\ndir_s$angle <- abs(dir_s$angle)\n\ndir_s_tidy <- dir_s %>%\n        separate(image, into = c(\"experiment\", \"accession\", \"water\", \"temp\", \"das\", \"plant\"), sep = \"-\")\n\n\nggplot(dir_s_tidy, aes(x = angle, y = count, colour = water)) +\n       facet_grid(~ accession) +\n        geom_point(size = 3, alpha = 0.4) +\n        labs(x = \"Angle\", y = \"count\") +\n              theme(panel.grid.major = element_blank(), \n              panel.grid.minor = element_blank()) +\n        ggsave(\"directionality.pdf\", height = 12, width = 16, units = \n                       \"cm\",useDingbats = FALSE) \n\ndir_hormone <- read.csv(\"data/root-data-sobel-dir.csv\")\ndir_hormone$angle <- abs(dir_hormone$angle)\n\ndir_hormone_tidy <- dir_hormone %>%\n        separate(image, into = c(\"experiment\", \"das\", \"accession\", \"water\",\n                                \"plant\", \"aq\"), sep = \"-\")\n\nggplot(dir_hormone_tidy, aes(x = angle, y = count, colour = water)) +\n       facet_grid(~ accession) +\n        geom_point(size = 3, alpha = 0.5) +\n        labs(x = \"Angle\", y = \"count\") +\n              theme(panel.grid.major = element_blank(), \n              panel.grid.minor = element_blank()) +\n        ggsave(\"directionality.pdf\", height = 12, width = 16, units = \n                       \"cm\",useDingbats = FALSE) \n\n\ndir_half <- read.csv(\"data/root-data-half-dir.csv\")\ndir_half$angle <- abs(dir_half$angle)\n\ndir_half_tidy <- dir_half %>%\n        separate(image, into = c(\"experiment\", \"das\", \"accession\", \"water\",\n                                \"plant\", \"aq\"), sep = \"-\")\n\nggplot(dir_half_tidy, aes(x = angle, y = count, colour = water)) +\n       facet_grid(~ accession) +\n        geom_point(size = 3, alpha = 0.5) +\n        geom_smooth() +\n        labs(x = \"Angle\", y = \"count\") +\n              theme(panel.grid.major = element_blank(), \n              panel.grid.minor = element_blank()) +\n        ggsave(\"directionality.pdf\", height = 12, width = 16, units = \n                       \"cm\",useDingbats = FALSE) \n\n\ndir_hormone_ks <- read.csv(\"data/root-data-half-dir-ks.csv\")\ndir_hormone_ks$angle <- abs(dir_hormone_ks$angle)\n\n              \nks.test(dir_hormone_ks$miz_ww, dir_hormone_ks$miz_wd)\n\n\n# experiment 64\n\ndir64 <- read.csv(\"data/64-root-data-dir.csv\")\ndir64$angle <- abs(dir64$angle)\n\ndir_tidy64 <- dir64 %>%\n        separate(image, into = c(\"experiment\", \"temp\", \"water\", \"transfer\", \n                                 \"das\", \"plant\", \"extra\"), sep = \"-\")\ndir_tidy64 <- tbl_df(dir_tidy64)\n\nggplot(dir_tidy64, aes(x = angle, y = count, colour = water)) +\n       facet_grid(temp ~ transfer) +\n        geom_point(size = 3, alpha = 0.4) +\n        geom_smooth()+\n        labs(x = \"Angle\", y = \"count\") +\n              theme(panel.grid.major = element_blank(), \n              panel.grid.minor = element_blank()) +\n        theme_bw()\n        ggsave(\"directionality64.pdf\", height = 12, width = 16, units = \n                       \"cm\",useDingbats = FALSE) \n\n\n\n\n# time course experiment\n\n\ndir_tc <- read.csv(\"data/time-course-root-data-dir.csv\")\ndir_tc$angle <- abs(dir_tc$angle)\n\ndir_tc_tidy <- dir_tc %>%\n        separate(image, into = c(\"experiment\", \"das\", \"accesion\", \"water\", \n                                 \"plant\", \"extra\"), sep = \"-\")\ndir_tc_tidy <- tbl_df(dir_tc_tidy)\n\nggplot(dir_tc_tidy, aes(x = angle, y = count, colour = water)) +\n       facet_grid(~ das ) +\n        geom_smooth()+\n        labs(x = \"Angle\", y = \"count\") +\n              theme(panel.grid.major = element_blank(), \n              panel.grid.minor = element_blank()) +\n        theme_bw()\n\n\n\n# time course experiment with depth data\n\ndir_tc_depth <- read.csv(\"data/time-course-depth-root-data-dir.csv\")\ndir_tc_depth$angle <- abs(dir_tc_depth$angle)\n\ndir_tc_depth_tidy <- dir_tc_depth %>%\n        separate(image, into = c(\"experiment\", \"das\", \"accesion\", \"water\", \n                                 \"plant\", \"extra\"), sep = \"-\")\ndir_tc_depth_tidy <- tbl_df(dir_tc_depth_tidy)\n\ndir_tc_depth_tidy %>%\n  filter(depth < 10) %>%\n  ggplot(aes(x = angle, y = count, colour = water)) +\n      geom_point(size = 2, alpha = 0.2) +\n      ylim(0, 4) +\n      facet_grid(depth ~ das) +\n      geom_smooth()+\n      labs(x = \"Angle\", y = \"count\") +\n      theme(panel.grid.major = element_blank(), \n      panel.grid.minor = element_blank())\n\n````\n\nScript for the plot of the relationship between the soil water content and the root angle\n\n\n\n## Complete images\n\nFirst we try to plot the relation between the soil water content using **complete images** of the root segment. transformation between pixel values and humidity is based on the regression plot found the figure 5 repo.\n\n```{r}\nseg <- read.csv(\"data/2015-02-23-soil-data-all.csv\")\nseg$humidity <- 221.0 - (3.96 * seg$environment)\nseg$das <- substr(seg$image, start = 4, stop = 5)\nseg$treatment <- substr(seg$image, start = 11, stop = 12)\n\n# Create a depth factor\nmax <- max(seg$start_y)\nseg$depth[seg$start_y < (max/3)] <- 1\nseg$depth[seg$start_y > (max/3) & seg$start_y < (2*(max/3))] <- 2\nseg$depth[seg$start_y > (2*(max/3))] <- 3\n\n```\n\n\nFirst we create a faceted plot, byt das and depth\n\n```{r}\n\n# Create a faceted plot by time and depth\nggplot(data = seg, aes(x = humidity, y = direction)) + \n  facet_grid(depth~das) +\n  geom_point(aes(colour=treatment), size=1, alpha=0.7) + \n  theme_bw()+\n  ylab(\"Root direction [°]\") +\n  xlab(\"Moisture content [%]\") \n\n```\n\nthen we look at the regression on the whole dataset. It does not look that good for me....\n\n```{r}\n\n# Plot the regression for the whole dataset\nfit <- lm(seg$direction ~ seg$humidity)\nsummary(fit)\n\nggplot(data = seg, aes(x = humidity, y = direction)) + \n  geom_abline(intercept = fit$coefficients[[1]], slope = fit$coefficients[[2]], colour=\"grey\")+\n  geom_point(aes(colour=treatment), size=1, alpha=0.7) + \n  theme_bw()+\n  ylab(\"Root direction [°]\") +\n  xlab(\"Moisture content [%]\") \n\n```\n\nThen we try a regression on mean values (by das). It look a bit better.\n\n```{r}\n# Plot the regression for the mean values\nrs <- ddply(seg, .( treatment, das), summarise, \n            dir = mean(direction), \n            dir.sd = sd(direction), \n            envi=mean(humidity, na.rm = T),\n            envi.sd=sd(humidity, na.rm = T))\n\nfit <- lm(rs$dir ~ rs$envi)\nprint(summary(fit))\n\nggplot(data = rs,aes(x = envi, y = dir)) + \n  geom_abline(intercept = fit$coefficients[[1]], slope = fit$coefficients[[2]], colour=\"grey\")+\n  geom_point(aes(colour=treatment), size=2, alpha=0.7) + \n  geom_errorbar(aes(ymin = dir-dir.sd, ymax = dir+dir.sd, height=0, colour=treatment), alpha=0.7) + \n  geom_errorbarh(aes(xmin = envi-envi.sd, xmax = envi+envi.sd, height=0, colour=treatment), alpha=0.7) +\n  theme_bw()+\n  ylab(\"Root direction [°]\") +\n  xlab(\"Moisture content [%]\") \n\n\n````\n\n## Differential images\n\nNext we try to plot the relation between the soil water content but using **differential images** images of the root segment\n\n```{r}\n\nseg <- read.csv(\"data/2015-02-23-soil-data-diff.csv\")\nseg$humidity <- 221.0 - (3.96 * seg$environment)\nseg$das <- substr(seg$image, start = 4, stop = 5)\nseg$treatment <- substr(seg$image, start = 11, stop = 12)\n\n# Create a depth factor\nmax <- max(seg$start_y)\nseg$depth[seg$start_y < (max/3)] <- 1\nseg$depth[seg$start_y > (max/3) & seg$start_y < (2*(max/3))] <- 2\nseg$depth[seg$start_y > (2*(max/3))] <- 3\n\n```\n\n\nFirst we create a faceted plot, by das and depth\n\n```{r}\n# Create a faceted plot by time and depth\n\nseg %>%\n  filter(das >15) %>%\n  ggplot(aes(x = humidity, y = direction)) + \n  facet_grid(~das) +\n  geom_point(aes(colour=treatment), size=3, alpha=0.7) + \n  theme_bw()+\n  ylab(\"Root direction [°]\") +\n  xlab(\"Moisture content [%]\") \n\n\n```\n\n\nNext, we make a regression on the whole dataset. Still does not look good\n\n```{r}\n# Plot the regression for the whole dataset\nfit <- lm(seg$direction ~ seg$humidity)\nprint(summary(fit))\n\nggplot(data = seg, aes(x = humidity, y = direction)) + \n  geom_abline(intercept = fit$coefficients[[1]], slope = fit$coefficients[[2]], colour=\"grey\")+\n  geom_point(aes(colour=treatment), size=1, alpha=0.7) +\n  theme_bw()+\n  ylab(\"Root direction [°]\") +\n  xlab(\"Moisture content [%]\") \n\n# Plot the regression by day\nfit <- lm(seg$direction ~ seg$humidity)\nprint(summary(fit))\n\nggplot(data = seg, aes(x = humidity, y = direction)) +\n  geom_point(aes(colour=treatment), size=1, alpha=0.7) +\n  facet_grid(depth~das) +\n  theme_bw()+\n  ylab(\"Root direction [°]\") +\n  xlab(\"Moisture content [%]\") \n\n\n```\n\n\nThen we try a regression in the mean data (by das). This is the best one for me...\n\n```{r}\n# Plot the regression for the mean values\nrs <- ddply(seg, .( treatment, das), summarise, \n            dir = mean(direction), \n            dir.sd = sd(direction), \n            envi=mean(humidity, na.rm = T),\n            envi.sd=sd(humidity, na.rm = T)),\n            dir.se = se(direction), \n            envi.se=se(humidity, na.rm = T))\n\nfit <- lm(rs$dir ~ rs$envi)\nprint(summary(fit))\n\nggplot(data = rs,aes(x = envi, y = dir)) + \n  geom_point(aes(colour=treatment), size=2, alpha=0.7) + \n  geom_errorbar(aes(ymin = dir-dir.sd, ymax = dir+dir.sd, height=0, colour=treatment), size=0.5, alpha=0.7) + \n  geom_errorbarh(aes(xmin = envi-envi.sd, xmax = envi+envi.sd, height=0, colour=treatment), size=0.5, alpha=0.7) +\n  theme_bw()+\n  ylab(\"Root direction [°]\") +\n  xlab(\"Moisture content [%]\") +\n    ggsave(\"angle_moisture.pdf\", height = 8, width = 10, units = \n                       \"cm\",useDingbats = FALSE) \n```\n",
    "created" : 1426204310036.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3950034268",
    "id" : "A72FDAA7",
    "lastKnownWriteTime" : 1426027392,
    "path" : "~/Dropbox/repos/glo_roots/figures/figure_10/figure_10.Rmd",
    "project_path" : null,
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_markdown"
}